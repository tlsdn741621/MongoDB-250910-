ì—°ìŠµí•˜ê¸°.

í˜„ìž¬ ë²„ì „ 8.0.4, í…ŒìŠ¤íŠ¸ í™•ì¸í•¨.

ê° êµ¬ì—­ í´ë” ë§Œë“¤ê¸°. 

ì°¸ê³  ì„¤ëª…. 
ê° ì˜µì…˜ì´ ì–´ë–¤ ì˜ë¯¸ë¥¼ ê°€ì§€ëŠ”ì§€ í•˜ë‚˜ì”© ì‚´íŽ´ë³´ê² ìŠµë‹ˆë‹¤.

mongod

ëª½ê³ ë””ë¹„ì˜ í•µì‹¬ ë°ì´í„°ë² ì´ìŠ¤ í”„ë¡œì„¸ìŠ¤, 
ì¦‰ ì„œë²„ ìžì²´ë¥¼ ì‹¤í–‰í•˜ëŠ” ê¸°ë³¸ ëª…ë ¹ì–´ìž…ë‹ˆë‹¤.

--replSet rs0

ì´ mongod ì¸ìŠ¤í„´ìŠ¤ê°€ ë¦¬í”Œë¦¬ì¹´ì…‹(Replica Set)ì— í¬í•¨ë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. 
ë¦¬í”Œë¦¬ì¹´ì…‹ì€ ë°ì´í„°ì˜ ë³µì œë³¸ì„ ì—¬ëŸ¬ ì„œë²„ì— ì €ìž¥í•˜ì—¬ 
**ê³ ê°€ìš©ì„±(High Availability)**ê³¼ ë°ì´í„° ì•ˆì •ì„±ì„ í™•ë³´í•˜ëŠ” ê¸°ìˆ ìž…ë‹ˆë‹¤.

rs0ëŠ” í•´ë‹¹ ë¦¬í”Œë¦¬ì¹´ì…‹ì˜ ê³ ìœ í•œ ì´ë¦„ìž…ë‹ˆë‹¤. 
rs0ë¼ëŠ” ì´ë¦„í‘œë¥¼ ê°€ì§„ íŒ€ì— í•©ë¥˜í•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.

--port 27018

ëª½ê³ ë””ë¹„ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²°ì„ ê¸°ë‹¤ë¦´ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

ëª½ê³ ë””ë¹„ì˜ ê¸°ë³¸ í¬íŠ¸ëŠ” 27017ì´ì§€ë§Œ, 
ì´ ëª…ë ¹ì–´ì—ì„œëŠ” 27018 í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. 
í•œ ì»´í“¨í„°ì—ì„œ ì—¬ëŸ¬ ëª½ê³ ë””ë¹„ ì„œë²„ë¥¼ ë„ìš¸ ë•Œ ì£¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

--bind_ip 0.0.0.0

ì„œë²„ê°€ ì–´ë–¤ IP ì£¼ì†Œë¡œë¶€í„°ì˜ ì ‘ì†ì„ í—ˆìš©í• ì§€ ì„¤ì •í•©ë‹ˆë‹¤.

0.0.0.0ì€ **ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì¸í„°íŽ˜ì´ìŠ¤(IP ì£¼ì†Œ)**ë¡œë¶€í„°ì˜ ì—°ê²°ì„ í—ˆìš©í•˜ë¼ëŠ” ì˜ë¯¸ìž…ë‹ˆë‹¤. 
ì¦‰, ë¡œì»¬ ì»´í“¨í„°(localhost)ë¿ë§Œ ì•„ë‹ˆë¼ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œë„ ì´ ì„œë²„ì— ì ‘ì†í•  ìˆ˜ ìžˆê²Œ ë©ë‹ˆë‹¤.

âš ï¸ ë³´ì•ˆ ì£¼ì˜: ë°©í™”ë²½ ë“± ë³„ë„ì˜ ë³´ì•ˆ ì„¤ì • ì—†ì´ 
ì´ ì˜µì…˜ì„ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ê°€ 
ì™¸ë¶€ì— ë¬´ë°©ë¹„ë¡œ ë…¸ì¶œë  ìˆ˜ ìžˆìœ¼ë‹ˆ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

--dbpath /db/data/rs0-0

ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  ë°ì´í„° íŒŒì¼(ì»¬ë ‰ì…˜, ì¸ë±ìŠ¤ ë“±)ì´ ì €ìž¥ë  ë””ë ‰í† ë¦¬ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

ì´ ì„œë²„ì˜ ëª¨ë“  ë°ì´í„°ëŠ” /db/data/rs0-0 í´ë” ì•ˆì— ìƒì„±ë˜ê³  ê´€ë¦¬ë©ë‹ˆë‹¤.

mkdir c:\db\data\rs0-0
mkdir c:\db\data\rs0-1
mkdir c:\db\data\rs0-2

	1. C:/db/data/rs0-0
	2. C:/db/data/rs0-1
	3. C:/db/data/rs0-2

ëª…ë ¹ì–´ ì°½1 í˜„ì œ, 10.100.201.87
mongod --replSet rs0 --port 27018 --bind_ip 0.0.0.0 --dbpath /db/data/rs0-0

ëª…ë ¹ì–´ ì°½2
mongod --replSet rs0 --port 27019 --bind_ip localhost --dbpath /db/data/rs0-1

ëª…ë ¹ì–´ ì°½3
mongod --replSet rs0 --port 27020 --bind_ip localhost --dbpath /db/data/rs0-2

ëª…ë ¹ì–´ ì°½4 ì—¬ê¸°ì„œ ìƒˆë¡œ ì ‘ì† -> ì´ ëª…ë ¹ì–´ì°½ 4ê°œ.
ì¡°ìž¥. ìžê¸° ì„œë²„ 
mongo --port 27018

ëª…ë ¹ì–´_ë³€ê²½, 
mongosh --port 27018


rs.initiate(
{
_id : "rs0",
members: [
{_id:0, host:"localhost:27018"},
{_id:1, host:"localhost:27019"},
{_id:2, host:"localhost:27020"}
]
}
)

ì¡°íšŒ 
	- rs.status()
ë³µì œì„¸íŠ¸ ìƒì„¸ì •ë³´ ì¡°íšŒ.
ê°„ë‹¨ ì¡°íšŒ: db.isMaster()


í™•ì¸. 
ì‰˜ì—ì„œ, í”„ë¼ì´ë¨¸ë¦¬ì—ì„œ ê¸€ ì“°ê¸° ìƒ˜í”Œ í•˜ë‚˜, 
í™•ì¸ì€ ,27019, 27020,
1) ì‰˜ì—ì„œ, ê°€ëŠ¥
2) ì»´íŒŒìŠ¤ì—ë„ ê°€ëŠ¥, 

í”„ë¼ì´ë¨¸ë¦¬ì— ì ‘ì† í›„(ëª…ë ¹ì–´ì°½ 4ë²ˆì§¸ì—ì„œ ê³„ì† ìž‘ì—….)
-exit 
ëª½ê³ ë””ë¹„ ì„œë²„ ì ‘ì† ëª…ë ¹ì–´
-mongo --port 27019 
-mongosh --port 27019 
-
db.replicationTest2.insertOne({hello2: 'world2'})

ì„¸ì»¤ë”ë¦¬ì— ì ‘ì† í•´ì„œ 
-
db.replicationTest2.find()

ì—ëŸ¬ ë°œìƒ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¸ì»¨ë”ë¦¬ì—ì„œ ëª½ê³ ë””ë¹„ ì…¸ ì‚¬ìš© ëª»í•˜ê²Œ ì„¤ì •ë˜ì–´ ìžˆìŒ.
rs.slaveOk()

db.getMongo().setReadPref("primaryPreferred");

rs.stepDown();

ðŸ“Œ ì„¤ëª…
í˜„ìž¬ Primaryë¥¼ Step Down(Primary ì—­í• ì„ í¬ê¸°)í•˜ì—¬ Secondary ì¤‘ í•˜ë‚˜ê°€ ìŠ¹ê²©ë¨.
rs.freeze(0);

ðŸ“Œ ì„¤ëª…

íŠ¹ì • Secondaryê°€ Primaryë¡œ ìŠ¹ê²©ë˜ì§€ ì•Šë„ë¡ ë™ê²°.


ìœˆë„ìš° í™˜ê²½ ì„¤ì • íŒŒì¼ 
ì„¤ì¹˜ëœ ë””ë ‰í„°ë¦¬ /bin/mongod.cfg 
ì—¬ê¸°ì„œ ì ‘ì† í—ˆìš©í•  ip ë“± ì˜µì…˜ ì„¤ì •.

cfg = rs.conf();
cfg.members[0].priority = 2;
rs.reconfig(cfg);

use local
db.oplog.rs.find().limit(1).pretty()


rs.printSlaveReplicationInfo()


ìƒíƒœì¡°íšŒ.
rs.status()
ì„¸ì»¨ë”ë¦¬ì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰ì‹œ í•„ìš”.
rs.slaveOk()

ì¡°ì›ë“¤ í†µì‹  í™•ì¸ 
cmd -> ping 10.100.201.x